---
title: "De Amorim"
format: html
toc: true
---
# Introduction
## Study organisation
### Question 1

```{r}
#| label: data loading
#| message: false
#| warning: false
  
library(readr)
courses <- read_csv("Database/courses.csv")


```

### Question 2

```{r}
#| label: data display

library(knitr)
kable(courses)

```

## Students
### Question 3

```{r}
#| label: Question 3
#| message: false
#| warning: false

library(tidyverse)
students <- read_csv("Database/students.csv")
spec(students)

students <-
  students |>
  mutate(sex = factor(sex, 
                      levels = c("M", "F"),
                      labels = c("Male", "Female")),
         group = factor(group),
         id = as.integer(id))

```

The birth_date column of the students data frame is of class `r class(students$birth_date)`.
The birth_date column of the students data frame is of class `r class(students$sex)`.

## Grades
### Question 4 

```{r}
#| message: false
#| warning: false

grades <- read_delim("Database/grades.csv", 
    delim = ":", 
    na = "$")

```

# Student population analysis
## Question 5

```{r}
#| message: false
#| warning: false
library(ggplot2)
library(ggthemes)

ggplot(students, aes(y = group))+
  geom_bar(aes(fill = group))+
  theme_clean()+
  labs(
    title = "Distribution of students by group"
  )+
  theme(legend.position = "none")

```


## Question 6 

```{r}
ggplot(students, aes(y = group))+
  geom_bar(aes(fill = sex))+
  theme_clean()+
  labs(
    title = "Distribution of students by group and by gender"
  )
```

## Question 7

```{r}
library(lubridate)

students <-
  students |> 
  mutate(age = round(time_length(today() - birth_date, unit = "year"), 1))

ggplot(students, aes(x=age))+
  geom_density()+
  theme_clean()+
  labs(
    title = "Distribution of students by age"
  )

```

## Question 8

```{r}

age_median <-
  students |> 
  summarise(age_median = median(age), .by = group) |>
  mutate(age_median = as.integer(age_median)) |> 
  arrange(group)

knitr::kable(age_median)

```

## Question 9

```{r}

max_table <-
  students |> 
  slice_max(age, by = group) |> 
  select(!birth_date) |> 
  arrange(desc(age))

knitr::kable(max_table)

```

# Simple Grade analysis
## Question 10

The data set contains  `r sum(!is.na(grades$grade))` grades.

## Question 11

```{r}

merged <- 
  students |>
  left_join(grades, by = "id") 
  


merged_Q11 <-
  merged |> 
  filter(course_id == 7) |> 
  summarise(mean_grade = mean(grade, na.rm = TRUE), .by = group )

ggplot(merged_Q11, aes(mean_grade, group))+
  geom_col()+
  theme_clean()+
  labs(
    title = "Distribution of grades in Hunting and Gathering Skills by group"
  )


```

