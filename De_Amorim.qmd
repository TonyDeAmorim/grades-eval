---
title: "De Amorim"
format: html
toc: true
---

Access the repo [here](https://github.com/TonyDeAmorim/grades-eval)

# Introduction

## Study organisation

### Question 1

```{r}
#| label: data loading
#| message: false
#| warning: false
  
library(readr)
courses <- read_csv("Database/courses.csv")


```

### Question 2

```{r}
#| label: data display

library(knitr)
kable(courses)

```

## Students

### Question 3

```{r}
#| label: Question 3
#| message: false
#| warning: false

library(tidyverse)
students <- read_csv("Database/students.csv")
spec(students)

students <-
  students |>
  mutate(sex = factor(sex, 
                      levels = c("M", "F"),
                      labels = c("Male", "Female")),
         group = factor(group),
         id = as.integer(id))

```

The birth_date column of the students data frame is of class `r class(students$birth_date)`. The birth_date column of the students data frame is of class `r class(students$sex)`.

## Grades

### Question 4

```{r}
#| message: false
#| warning: false

grades <- read_delim("Database/grades.csv", 
    delim = ":", 
    na = "$")

```

# Student population analysis

## Question 5

```{r}
#| message: false
#| warning: false
library(ggplot2)
library(ggthemes)

ggplot(students, aes(y = group))+
  geom_bar(aes(fill = group))+
  theme_clean()+
  labs(
    title = "Distribution of students by group"
  )+
  theme(legend.position = "none")

```

## Question 6

```{r}
ggplot(students, aes(y = group))+
  geom_bar(aes(fill = sex))+
  theme_clean()+
  labs(
    title = "Distribution of students by group and by gender"
  )
```

## Question 7

```{r}
library(lubridate)

students <-
  students |> 
  mutate(age = round(time_length(today() - birth_date, unit = "year"), 1))

ggplot(students, aes(x=age))+
  geom_density()+
  theme_clean()+
  labs(
    title = "Distribution of students by age"
  )

```

## Question 8

```{r}

age_median <-
  students |> 
  summarise(age_median = median(age), .by = group) |>
  mutate(age_median = as.integer(age_median)) |> 
  arrange(group)

knitr::kable(age_median)

```

## Question 9

```{r}

max_table <-
  students |> 
  slice_max(age, by = group) |> 
  select(!birth_date) |> 
  arrange(desc(age))

knitr::kable(max_table)

```

# Simple Grade analysis

## Question 10

The data set contains `r sum(!is.na(grades$grade))` grades.

## Question 11

```{r}

merged <- 
  students |>
  left_join(grades, by = "id") 

merged_Q11 <-
  merged |> 
  filter(course_id == 7) |> 
  summarise(mean_grade = mean(grade, na.rm = TRUE), .by = group )

ggplot(merged_Q11, aes(mean_grade, group))+
  geom_col()+
  theme_clean()+
  labs(
    title = "Distribution of grades in Hunting and Gathering Skills by group"
  )


```

## Question 12

```{r}
merged_full <-
  merged |> 
  left_join(courses, by = "course_id") 

ggplot(merged_full, aes(x=grade))+
  geom_histogram( na.rm=TRUE, binwidth = 0.7)+
  facet_wrap(~trimester)+
  theme_clean()+
  labs(
    title = "Distribution of grades by trimester"
  )
  
```

# Attendance analysis

## Question 13

```{r}
grades_per_student <-
  merged_full |>
  reframe(
    n_grades = sum(!is.na(grade)),
    group = first(group),
    sex   = first(sex),
    .by = id
  ) |>
  select(id, group, sex, n_grades) |>
  arrange(id) 

grades_per_student_13 <-
  grades_per_student |> 
  slice_tail(n = 10) 

knitr::kable(grades_per_student_13)




```



|        |     |
|--------|-----|
| Mean   |  `r mean(grades_per_student$n_grades)`   |
| Median |   `r median(grades_per_student$n_grades)`  |
| Min    |    `r min(grades_per_student$n_grades)` |
| Max    |    `r max(grades_per_student$n_grades)` |

## Question 14

```{r}
ggplot(grades_per_student, aes(n_grades))+
  geom_histogram(binwidth = 0.5)+
  facet_wrap(~sex)+
  theme_clean()+
  labs(
    title = "Distribution of number of grades by gender"
  )
```


## Question 15

```{r}
grades_per_student_15 <-
  merged_full |>
  filter(course_id == 8) |> 
  reframe(
    n_grades = sum(!is.na(grade)),
    group = first(group),
    sex   = first(sex),
    .by = id
  ) |>
  select(id, group, sex, n_grades) |>
  arrange(desc(n_grades)) 

grades_per_student_15_sliced <-
  grades_per_student_15 |> 
  slice_tail(n = 5) 

knitr::kable(grades_per_student_15_sliced)
```

## Question 16

```{r}
grades_per_student_16 <- 
  grades_per_student_15 |> 
  summarise(n = n(), .by =n_grades)

ggplot(grades_per_student_16, aes(n_grades, n))+
  geom_col()+
  theme_clean()+
  labs(
    title = "Distribution of number of grades"
  )
```

## Question 17

```{r}
ggplot(grades_per_student_15, aes(group,n_grades, fill = group))+
  geom_violin()+
  theme_clean()+
  labs(
    title = "Distribution of number of grades by group"
  )
```

## Question 18

```{r}
ggplot(grades_per_student_15, aes(group,n_grades, fill = group))+
  geom_violin()+
  theme_clean()+
  labs(
    title = "Distribution of number of grades by group"
  )+
  facet_wrap(~sex)
```

# Grade analysis
## Question 19

```{r}

Q19 <-
  merged_full |> 
  reframe(mean = mean(grade, na.rm =TRUE), .by = c(id,course),group = first(group), sex = first(sex)) |> 
  pivot_wider(
    names_from = course,
    values_from = mean
  ) 

Q19_sliced <-
  Q19 |>
  select(1:4) |> 
  slice_tail(n=10)

knitr::kable(Q19_sliced)
  

```

## Question 20

```{r}

ggplot(Q19, aes(`Astronomy and Celestial Navigation`, `Drumming and Music`))+
  geom_point(alpha = 0.6)+
  theme_clean()+
  labs(
    title = "Average grades in Drumming and Music as a function of the average grades in As-
tronomy and Celestial Navigation"
  )

```

## Question 21

```{r}
Q21 <-
  Q19 |> 
  summarise(cor = cor(`Animal Lore and Totemism`,`Earth Magic and Fertility Rituals`), .by =group) 


  knitr::kable(Q21)
```

## Question 22

```{r}

grp <- max(abs(Q21$cor)) # group 15

Q22 <-
  Q19 |> 
  filter(group==15)

ggplot(Q22, aes(`Animal Lore and Totemism`,`Earth Magic and Fertility Rituals`))+
  geom_point(alpha = 0.6)+
  theme_clean()+
  labs(
    title = "Average grades in Earth Magic and Fertility Rituals as a function the average grades in Animal Lore and Totemism in group 15"
  )

```

## Question 23

```{r}
final <-
  Q19 |> 
  reframe(final_grade = sum(3:12)/(12-3), .by = id ,group = first(group), sex = first(sex)) |>
  arrange(desc(final_grade)) |> 
  relocate(final_grade, .after = last_col())
  
```

## Question 24

```{r}

```

